{% extends 'main.html' %}
<<<<<<< HEAD
=======
{% load custom_filters %}
>>>>>>> 71175b8eb7fbc8ef5928364bc43583c36dfc8898

{% block content %}
{% include 'navbar.html' %}
<div class="content">
<<<<<<< HEAD
    {% if user.is_superuser %}
        <button onclick="window.location.href='{% url 'main:add_recipe' %}'">Add Recipe</button>
=======
    {% if user.is_superuser or user.is_staff %}
        <button type="submit" id="search-button" class="bg-[#8FBC8F] text-white px-4 py-2 rounded-lg font-bold hover:bg-[#6B8E23] transition-all duration-300 shadow-lg search-button" style="height: 40px; margin-right: 10px;"
            onclick="window.location.href='{% url 'main:add_recipe' %}'">
            Add Recipe
        </button>
>>>>>>> 71175b8eb7fbc8ef5928364bc43583c36dfc8898
    {% else %}
        <p>You do not have permission to add recipes.</p>
    {% endif %}
</div>
<div class="container mx-auto p-4">
<<<<<<< HEAD
    {% if query %}
    <h1 class="text-2xl font-bold">Search Results for "{{ query }}"</h1>
    {% endif %}

    {% if recipes %}
        <h2 class="text-xl font-semibold mt-4">Recipe List</h2>
        <ul class="space-y-4">
            {% for recipe in recipes %}
                <li class="border p-4 rounded shadow">
                    <h3 class="text-xl font-bold">{{ recipe.recipe_name }}</h3>
                    {% if recipe.image_url %}
                        <img src="{{ recipe.image_url }}" alt="{{ recipe.recipe_name }}" class="w-48 h-auto mb-2" />
                    {% else %}
                        <img src="{{ recipe.image_url }}" alt="{{ recipe.recipe_name }}" style="width:200px; height:auto;">
                    {% endif %}
                    <p><strong>Cooking Time:</strong> {{ recipe.cooking_time }}</p>
                    <p><strong>Servings:</strong> {{ recipe.servings }}</p>
                    
                    <p class="mt-2"><strong>Ingredients:</strong></p>
                    <ul class="list-disc pl-5">
                        {% for ingredient in recipe.ingredients.all %}
                            <li>{{ ingredient.name }}</li>
                        {% empty %}
                            <li>No ingredients available.</li>
                        {% endfor %}
                    </ul>
                    
                    <p class="mt-2"><strong>Instructions:</strong></p>
                    <ol class="list-decimal pl-5">
                        {% for instruction in recipe.recipe_instructions.all|dictsort:"step_number" %}
                            <li>{{ instruction.description }}</li> 
                        {% empty %}
                            <li>No instructions available.</li>
                        {% endfor %}
                    </ol>
=======
    <h1 class="text-2xl font-bold mb-4">Recipe Catalog</h1>

    {% if recipes %}
        <ul class="space-y-4">
            {% for recipe in recipes %}
                <li class="border p-4 rounded shadow bg-white">
                    <a href="{% url 'show_recipe_by_id' recipe.id %}" class="block">
                        <div class="flex flex-col">
                            <h2 class="text-xl font-bold text-gray-800">{{ recipe.recipe_name }}</h2>
                            {% if recipe.image_url %}
                                <img src="{{ recipe.image_url }}" alt="{{ recipe.recipe_name }}" class="w-48 h-auto mb-2" />
                            {% else %}
                            {% endif %}
                        </div>
                    </a>
                    <div class="flex w-full justify-between mt-2">
                        {% if user.is_superuser or user.is_staff %}
                            <div class="space-x-2">
                                <button onclick="deleteProduct('{{ recipe.pk }}');" class="bg-red-500 text-white px-3 hover:bg-red-600 rounded-[8px] p-1 hover:scale-110">Delete</button>
                            </div>
                        {% endif %}
                        <button
                            id="star-{{ recipe.id }}"
                            class="star-btn text-gray-400"
                            onclick="toggleFavorite({{ recipe.id }}, {% if user.is_authenticated %}{{ user.id }}{% else %}null{% endif %})"
                        >
                            â˜…
                        </button>
                    </div>
>>>>>>> 71175b8eb7fbc8ef5928364bc43583c36dfc8898
                </li>
            {% endfor %}
        </ul>
    {% else %}
<<<<<<< HEAD
        <p class="text-center mt-4 py-10 text-gray-500">No recipes found for your search.</p>
    {% endif %}
</div>
=======
        <p class="text-center mt-4 text-gray-500">No recipes available.</p>
    {% endif %}
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    {% for recipe in recipes %}
        FavoritDefault({{ recipe.id }}, {{ request.user.id }});
    {% endfor %}
});

// Function to toggle favorite
function toggleFavorite(id_makanan, id_user) {
    const starButton = document.getElementById(`star-${id_makanan}`);
    const isFavorite = starButton.classList.contains("text-yellow-400");
    
    if (!id_user) {
        alert("You must be logged in to favorite a recipe.");
        return;
    } else {
        if (isFavorite) {
            delete_makanan_favorit(id_makanan, id_user, starButton);
        } else {
            create_makanan_favorit(id_makanan, id_user, starButton);
        }
    }
}

function FavoritDefault(id_makanan, id_user) {
    const starButton = document.getElementById(`star-${id_makanan}`);
    fetch(`/favorites/cek_favorit/${id_user}/${id_makanan}/`, {
        method: "GET",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}",
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            starButton.classList.remove("text-gray-400");
            starButton.classList.add("text-yellow-400");
        }
    });
}

// AJAX function to remove recipe from favorites
function delete_makanan_favorit(id_makanan, id_user, starButton) {
    fetch(`/favorites/delete/${id_user}/${id_makanan}/`, {
        method: "DELETE",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}",
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            starButton.classList.remove("text-yellow-400");
            starButton.classList.add("text-gray-400");
            console.log("Favorite successfully deleted.");
        } else {
            console.error("Error removing from favorites:", data.message);
        }
    })
    .catch(error => console.error("Error:", error));
}

// AJAX function to add recipe back to favorites
function create_makanan_favorit(id_makanan, id_user, starButton) {
    fetch(`/favorites/create/${id_user}/${id_makanan}/`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}",
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            starButton.classList.remove("text-gray-400");
            starButton.classList.add("text-yellow-400");
            console.log("Favorite successfully added.");
        } else {
            console.error("Error adding to favorites:", data.message);
        }
    })
    .catch(error => console.error("Error:", error));
}

async function deleteProduct(id) {
    await fetch(`/delete/${id}`, {method: "DELETE"}).then(response => {
        if (response.status === 204) {
            window.location.href = "/";
        }
    }).catch(err => alert("Error:" + err));
}
</script>

<style>
.star-btn {
    font-size: 1.5rem;
    cursor: pointer;
    transition: color 0.3s;
}
.star-btn.text-yellow-400 {
    color: #fbbf24;
}
.star-btn.text-gray-400 {
    color: #9ca3af;
}
</style>
>>>>>>> 71175b8eb7fbc8ef5928364bc43583c36dfc8898
{% endblock %}
